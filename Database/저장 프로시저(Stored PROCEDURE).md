# ⭐️저장 프로시저(Stored PROCEDURE)

### 일련의 쿼리를 마치 하나의 함수처럼 실행하기 위한 쿼리의 집합

여러줄의 쿼리를 한번의 요청으로 실행할 수 있도록 하는 함수 같은 역할을 한다.

프로시저를 만들어두면, 해당 쿼리문이 필요할 때 인자값만 프로시저에 전달하여 쉽게 원하는 결과물을 만들 수 있다.

PL/SQL Block(절차형 SQL block)이다.

<aside>
💡 PL/SQL ? : 응용 프로그램에서의 데이터베이스 처리 성능을 향상시키기 위해 SQL 문장에서 변수정의, 조건처리, 반복처리 등을 지원하며, 오라클 자체에 내장되어있는 Procedure Laguage이다. 프로시저, 사용자 정의 함수, 트리거 등을 개발 할 수 있다.

</aside>

```sql
CREATE OR REPLACE PROCEDURE 프로시저명(변수명1 IN 데이터타입, 변수명2 OUT 데이터타입) -- 인자 값은 필수 아님
IS
[
변수명1 데이터타입;
변수명2 데이터타입;
..
]
BEGIN -- 필수
 필요한 기능; -- 인자값 활용 가능
 
EXCEPTION -- 예외 발생 시

END; -- 필수

EXEC 프로시저명; -- 호출
```

변수의 MODE 

1. IN : 운영체제에서 프로시저로 전달될 변수 모드

```sql
CREATE OR REPLACE PROCEDURE test( name IN VARCHAR2 ) 
IS
	msg VARCHAR2(5) := '내 이름은';
BEGIN 
	dbms_output.put_line(msg||' '||name); 
END;

EXEC test('수민');
```

2. OUT: 프로시저에서 처리된 결과를 운영체제로 전달

```sql
CREATE OR REPLACE PROCEDURE test( name OUT VARCHAR2 ) 
IS
BEGIN 
	name := '수민'
END;

DECLARE
out_name VARCHAR2(100);

BEGIN
test(out_name);
dbms_output.put_line('내 이름은 '||out_name);
END;
```

3. INOUT: IN, OUT 두가지 기능 모두 수행

**장점**

1. 최적화 & 캐시
    
    프로시저의 최초 실행 시 최적화 상태로 컴파일이 되며, 그 이후 프로시저 캐시에 저장된다.
    
    만약 해당 프로세스가 여러번 사용될 때, 다시 컴파일 작업을 거치지 않고 캐시에서 가져오게 된다.
    
2. 유지 보수
    
    작업이 변경될 때, 다른 작업은 건드리지 않고 프로시저 내부에서 수정만 하면 된다. (But, 장점이 단점이 될 수도 있는 부분이기도.. )
    
3. 트래픽 감소
    
    클라이언트가 직접 SQL문을 작성하지 않고, 프로시저명에 매개변수만 담아 전달하면 된다. 즉, SQL문이 서버에 이미 저장되어 있기 때문에 클라이언트와 서버 간 네트워크 상 트래픽이 감소된다.
    
4. 보안
    
    프로시저 내에서 참조 중인 테이블의 접근을 막을 수 있다.
    

**단점**

1. 호환성
    
    구문 규칙이 SQL / PSM 표준과의 호환성이 낮기 때문에 코드 자산으로의 재사용성이 나쁘다.
    
2. 성능
    
    문자 또는 숫자 연산에서 프로그래밍 언어인 C나 Java보다 성능이 느리다.
    
3. 디버깅
    
    에러가 발생했을 때, 어디서 잘못됐는지 디버깅하는 것이 힘들 수 있다.
    


**실제로 프로시저는 잘 사용하지 않는다.**

객체지향적 방법론이 대세가 되어 JPA등의 방법을 더 많이 쓴다.

클라우드 시스템이 대중화되어 프로시저같이 특정 기술에 의존적인 부분은 기피한다.

프로시저를 사용하면 DB의 부하가 커지기 때문에 WAS에서 처리하도록 하는 게 좋다.

하지만 Batch같은 트래픽 증가 문제가 없는 로직에 대해서는 여전히 프로시저 형태를 사용하는게 효율적일 수 있다.
