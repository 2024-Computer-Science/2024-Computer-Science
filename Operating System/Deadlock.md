# DeadLock

# 데드락(DeadLock, 교착 상태)

→ 두 개 이상의 작업이 서로 상대방의 작업이 끝나기 만을 기다리고 있어서 결과적으로 아무것도 완료되지 못하는 상태. (시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생)

![Untitled](https://github.com/2024-Computer-Science/2024-Computer-Science/assets/21362256/62a69c27-0e88-4fd5-81b1-00e92e70b05f)

---

## 데드락의 발생 조건

### 1. 상호 배제(Mutual exclusion)

→ 한 번에 하나의 프로세스만 해당 자원을 사용할 수 있을 때, 사용중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때가지 기다려야 한다.

### 2. 점유 대기(Hold and wait)

→ 최소한 하나의 자원을 보유하고, 다른 프로세스에 할당된 자원을 점유하기 위해 대기하는 프로세스가 존재해야 한다.

### 3. 비선점(No Preemption)

→ 다른 프로세스에 이미 할당된 자원을 강제로 빼앗을 수 없다.

### 4. 순환 대기(Circular wait)

→ 대기 프로세스의 집합이 순환 형태로 자원을 대기하고 있어야 한다.

---

## 데드락 해결 방법

- 데드락 예방(Prevention)
- 데드락 회피(Avoidance)
- 데드락 탐지(Detection) & 회복(Recevery)

---

## 데드락 예방(Prevention)

→ 데드락 발생조건 4가지 중 하나라도 발생이 되지 않게 예방시키는 것.

(상호 배제, 점유 대기, 비선점, 순환 대기 이 네 개의 문제를 각각 방지(부정)시킴)

### 1. 상호 배제 조건 방지

- 한 번에 여러 프로세스가 공유 자원을 사용할 수 있게 하는 방법
    
    (But, 추후 동기화 관련 문제가 발생할 수 있음)
    

### 2. 점유 대기 조건 방지

- 프로세스 실행에 필요한 모든 자원을 한꺼번에 요구하고 허용할 때까지 작업을 보류해서, 나중에 또 다른 자원을 점유하기 위한 대기 조건을 성립하지 않도록 하는 방법

### 3. 비선점 조건 방지

- 이미 다른 프로세스에게 할당된 자원이 선점권이 없다고 가정할 때, 높은 우선순위의 프로세스가 해당 자원을 선점할 수 있도록 하는 방법

### 4. 순환 대기 조건 방지

- 자원을 순환 형태로 대기하지 않도록 일정한 한 쪽 방향으로만 자원을 요구할 수 있도록 하는 방법

→ 위와 같은 방법을 통해 데드락을 예방할 수는 있지만, 시스템의 처리량이나 효율성을 떨어뜨리는 단점이 발생할 수도 있다.

---

## 데드락 회피(Avoidance)

→ 데드락 발생 시 데드락을 피해나가는 방법

(자원을 할당한 후에도 시스템이 항상 Safe state에 있을 수 있도록 할당을 허용하는 것이 특징)

<aside>
💡 **안전 상태(Safe State)**
시스템의 프로세스들이 요청하는 모든 자원을 데드락을 발생시키지 않으면서도 차례로 모두에게 할당해 줄 수 있는 상태

**안전 순서(Safe Sequence)**
특정한 순서로 프로세스들에게 자원을 할당, 실행 및 종료 등의 작업을 할 때 데드락이 발생하지 않는 순서

</aside>

### 은행원 알고리즘(Banker’s Algorithm)

→ 어떤 자원의 할당을 허용하는지에 관한 여부를 결정하기 전에, 미리 결정된 모든 자원들의 최대 가능한 할당량을 가지고 시뮬레이션 해서 Safe state에 들 수 있는지 여부를 검사하는 알고리즘

(예시)

![Untitled 1](https://github.com/2024-Computer-Science/2024-Computer-Science/assets/21362256/c4de7425-491b-42c9-9209-d3803a376ba2)



→ 그러나 사전에 최대 자원 요구량을 알아야 함, 할당할 수 있는 자원의 수가 일정해야 함… 등의 제약 조건을 모두 지켜야 하기 때문에 자원 이용도의 하락이라는 단점도 존재.

---

## 데드락 탐지(Detaction) & 회복(Recovery)

→ 데드락 예방이나 회피를 사용하지 않았을 때, 데드락이 발생할 수 있으니, 이에 대해 회복하기 위해 데드락을 탐지하고 회복하는 알고리즘

### 탐지 기법

- Allocation, Request, Available 등으로 시스템에 데드락이 발생했는지 여부를 탐색.
- 자원 할당 그래프를 통해 탐지

### 회복 기법

→ 순환 대기에서 벗어나 데드락으로부터 회복하기 위한 방법을 사용

- 프로세스 1개 이상 중단시키기
    - 데드락에 빠진 모든 프로세스 중단시키기
    - 프로세스를 하나씩 중단시킬 때마다 탐지 알고리즘으로 데드락을 탐지하면서 회복시키기
- 자원 선점하기
    - 프로세스에 할당된 자원을 선점해서, 교착 상태를 해결할 때까지 그 자원을 다른 프로세스에 할당해주는 방법

<aside>
💡 <참고자료>
[https://chanhuiseok.github.io/posts/cs-2/](https://chanhuiseok.github.io/posts/cs-2/)

</aside>
