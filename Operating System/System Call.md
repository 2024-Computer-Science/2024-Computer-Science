## System Call
> **응용 프로그램이 OS에 특정 작업을 요청할 때 사용하는 함수**

프로세스가 하드웨어에 직접 접근해서 필요한 기능을 사용할 수 있게 한다. 

```
💡 사용자와 운영체제는 시스템 자원을 공유한다. 
사용자에게 제한을 두지 않으면 사용자가 메모리 내의 주요 운영체제 자원을 망가뜨릴 위험이 생기게 된다. 
따라서, 사용자의 시스템 자원 접근을 제한하는 보호 장치가 필요하다. 
System Call은 이 보호 장치 역할을 한다.
```

<br>

## CPU 모드

CPU는 사용자 애플리케이션이 시스템 손상시키는 것을 방지하기 위해 2가지 모드를 제공

1. **User Mode**
    
    사용자 애플리케이션 코드 실행
    
    사용자가 접근할 수 있는 영역에 제한이 있기 때문에 하드웨어에 접근 X (접근을 위해서는 시스템콜 사용)
    
2. **Kernel Mode**
    
    OS가 CPU를 사용하는 모드
    
    시스템 콜을 통해 커널모드로 전환되면 OS는 하드웨어를 제어하는 명령어 실행 (유저 모드에서 실행 시 Exception)

    
<br>


💡 **시스템 콜은 커널 모드에서 실행되며, 유저 모드에서 호출한다.**

<img src="https://images.velog.io/images/fredkeemhaus/post/0e1783f1-2ee7-4192-989d-497eea8dbf5d/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202022-01-05%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.36.13.png">
유저 모드에서 시스템 콜을 호출하면, OS는 시스템 콜을 처리하기 위해 커널 모드로 전환합니다. 커널 모드에서 시스템 콜을 처리한 후, OS는 다시 유저 모드로 돌아갑니다.

<br>


## 작동 방식


1. **라이브러리 함수(printf)를 호출**한다.
2. 라이브러리 함수 내부에서 **시스템 콜(write)를 호출**한다.
3. 해당 **시스템 콜의 인덱스(4)**를 CPU 레지스터에 **저장**한다. ← 시스템 콜의 인덱스: 시스템 콜의 종류를 나타내는 것
4. 0x80 **인터럽트를 발생**시킨다.(**커널 모드로 전환 = 시스템 자원 접근 가능**)
5. IDT(Interrupt Descriptor Table)를 참조하여 **system_call()을 호출**한다. ← IDT: 미리 정의되어 있는 인터럽트들의 번호 와 실행 코드를 가리키는 주소 들이 저장되어 있는 Table.
6. 이때 3에서 **저장한 인덱스(4)**를 system_call() 함수 내에 **전달**한다.
7. sys_call_table을 참조해 해당 인덱스에 맞는 **기능(sys_write)을 호출**한다.
8. 수행이 모두 **끝나면 사용자 모드로 전환**된다.

<br>

## 시스템 콜 종류

프로세스 제어, 파일 조작, 장치 관리, 정보 유지, 통신, 보호
<img src="https://blog.kakaocdn.net/dn/GgtfT/btrfVtgH8bv/sgMEqLlLOFkg3DFjteW5W0/img.png">

